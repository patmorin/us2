\documentclass{patmorin}
\listfiles


\definecolor{brightmaroon}{rgb}{0.76, 0.13, 0.28}
\definecolor{linkblue}{rgb}{0, 0.337, 0.227}
\newcommand{\defin}[1]{\emph{\color{brightmaroon}#1}}
\setlength{\parskip}{1ex}

\DeclareMathOperator{\outn}{out}
\DeclareMathOperator{\comp}{comp}

\title{\MakeUppercase{A Unique Superior is Still One Too Many}}
\author{Bra\v{c} 2023 Gang}


\newcommand{\rn}[1]{\chi_{\operatorname{#1-vr}}}
\newcommand{\irn}{\rn{\infty}}
% \newcommand{\trn}{\rn{2}}
\newcommand{\trn}{\chi_{\mathrm{us}}}
\newcommand{\lrn}{\rn{\ell}}
\newcommand{\dtcn}{\bar{\chi}_2}
\newcommand{\dlcn}{\bar{\chi}_\ell}
\newcommand{\scn}{\chi_{\star}}


% \pagenumbering{roman}
\begin{document}

\maketitle

\begin{abstract}
  A \defin{unique-superior colouring} (also known as a \defin{$2$-vertex-ranking} or \defin{restricted star colouring}) is a mapping $\varphi:V(G)\to\N$ of the vertices of a graph $G$ to integer colours so that for any edge $uv$, $\varphi(u)\neq \varphi(v)$ and for any $3$-vertex path $uvw$, $\phi(u)\neq\varphi(w)$ or $\varphi(v)>\varphi(u)$.  For a graph $G$, the \defin{unique-superior chromatic number} $\trn(G)$ is the minimum value of $k$ such that $G$ has a us-colouring $\varphi:V(G)\to\{1,\ldots,k\}$.  We show that there exists a constant $c$ such that every $n$-vertex $d$-degenerate graph $G$ has $\trn(G) \le cd(dn\log n)^{1/3}=O((n\log n)^{1/3})$ for fixed $d$.  Previously, the best-known bound for $d$-degenerate graphs, due to \citet{karpas.neiman.ea:on}, was $O(\sqrt{dn})$. These results extend to the \defin{$\ell$-vertex-ranking} problem in which one considers paths $v_0,\ldots,v_r$ of length $r\le \ell$ and requires that $\varphi(v_0)\neq\varphi(v_r)$ or that $\varphi(v_0)<\max\{\varphi(v_1),\ldots,\varphi(v_{r-1})\}$.  In this setting, for any fixed $\ell$ and $d$, the bound on the $\ell$-vertex-ranking number $\lrn(G)$ for any $d$-degenerate graph $G$ is $\tilde{O}(n^{(\ell-1)/(\ell+1)})$.
\end{abstract}


% \tableofcontents
%
% \newpage
% \pagenumbering{arabic}



\section{Introduction}

A \defin{unique-superior colouring} (also known as a \defin{$2$-vertex-ranking} or \defin{restricted star colouring}) is a mapping $\varphi:V(G)\to\N$ of the vertices of a graph $G$ to integer colours so that for any edge $uv$, $\varphi(u)\neq \varphi(v)$ and for any $3$-vertex path $uvw$, $\varphi(u)\neq\varphi(w)$ or $\varphi(v)>\varphi(u)$.  For a graph $G$, the unique-superior chromatic number $\trn(G)$ is the minimum value of $k$ such that $G$ has a us-colouring $\varphi:V(G)\to\{1,\ldots,k\}$.

\citet{karpas.neiman.ea:on} showed that for every $d$-degenerate $n$-vertex graph $G$, $\trn(G)\in O(\sqrt{dn})$ and that there exists $2$-degenerate $n$-vertex graphs with $\trn(G)\in\Omega(n^{1/3})$.\footnote{In \cite[Theorem~6.2]{karpas.neiman.ea:on} the authors prove the bound $O(d\sqrt{n})$, but an easy optimization of their argument (separately colouring all vertices of degree greater than $\sqrt{n/d}$) improves this to $O(\sqrt{dn})$.}  They leave the question of closing the gap between these bounds as an open problem. In the current paper we give a colouring procedure that essentially matches their lower bound to within a polylogarithmic factor.  In particular, for fixed $d$, $\trn(G)\in \tilde{O}(n^{1/3})$.

\begin{thm}\label{d_degenerate_upper_bound}
  There exists a constant $c>0$ such that for any integer $d\ge 1$, every $n$-vertex $d$-degenerate graph $G$ has $\trn(G) \le c d(dn\log n)^{1/3}$.
\end{thm}

Like the upper bound in \cite{karpas.neiman.ea:on} \cref{d_degenerate_upper_bound} follows quickly from a theorem about graphs that are both $d$-degenerate and have maximum-degree $\Delta$. For such graphs, we prove:

\begin{thm}\label{degenerate_and_degree}
  There exists a fixed $c>0$ such that
  for all integers $d,\Delta \ge 1$, and $n> \Delta$, every $d$-degenerate $n$-vertex graph $G$ of maximum degree at most $\Delta$ has
  $\trn(G)\leq cd^{3/2}\sqrt{\Delta}\log^{1/2} n$.
\end{thm}

\Cref{d_degenerate_upper_bound} follows easily from \cref{degenerate_and_degree}, by the following argument:  Since $G$ is $d$-degenerate, it has at most $dn$ edges and the sum of its vertex degrees is at most $2dn$.  Let $\Delta:=d^{-1/3}n^{2/3}\log^{-1/3} n$.  Then the set $S:=\{v\in V(G):\deg_G(v)\ge \Delta\}$ has size at most $2dn/\Delta=2d^{4/3}n^{1/3}\log^{1/3} n$.  Since $G-S$ has maximum degree $\Delta$, $G-S$ has a us-colouring $\varphi$ using at most
\[
  cd^{3/2}\sqrt{\Delta}\log^{3/4} n
  % = c\cdot \sqrt{\frac{n^{2/3}}{d^{1/3}\log^{1/2} n}}\cdot \log^{3/4} n
  = c\cdot d^{\tfrac{3}{2}-\tfrac{1}{6}}n^{\tfrac{1}{3}}\log^{\tfrac{1}{2}-\tfrac{1}{6}} n
  = c\cdot d^{\tfrac{4}{3}}n^{\tfrac{1}{3}}\log^{\tfrac{1}{3}} n
\]
 colours, by \cref{degenerate_and_degree}. We can extend $\varphi$ to a colouring of $G$ by assigning each vertex in $S$ a distinct colour that is larger than every colour used in the colouring of $G-S$.  Thus, $\trn(G)\le cd^{4/3}n^{1/3}\log^{1/2} n+2d^{4/3}n^{1/3}\log^{1/3} n= (c+2)d^{4/3}n^{1/3}\log^{1/3} n$, which establishes \cref{d_degenerate_upper_bound}.  In the next section, we prove \cref{degenerate_and_degree}.

\section{The Proof}

We use standard graph-theoretic terminology and conventions as used in the textbook by \citet{diestel:graph}. A graph $G$ has vertex set $V(G)$ and edge set $E(G)$.  For an integer $\ell$, $G^\ell$ denotes the graph with vertex set $V(G)$ that contains an edge $vw$ if and only if $G$ contains a path of length at most $\ell$ with endpoints $v$ and $w$.

When considering a directed graph $G$, $N^+_{G}(v):=\{w\in V(G):\overrightarrow{vw}\in E(G)\}$ denotes the (open) out-neighbourhood of a vertex $v$ in $G$ and $\deg^+_{G}(v):=|N^+_G(v)|$ is the out-degree of $v$ in $G$.  We also define $N^+_{G}[v]:=\{v\}\cup N_{G}(v)$ to be the closed out-neighbourhood of $v$ in $G$.

\begin{proof}[Proof of \cref{degenerate_and_degree}]
  Let $S_0:=V(G)$ and, for each integer $i\ge 1$, let $S_i:=\{v\in S_{i-1}:\deg_{G[S_{i-1}]}(v)\ge 4d\}$.  Since $G$ is $d$-degenerate $G[S_{i-1}]$ has at most $d|S_{i-1}|$ edges.  Therefore $2d|S_{i-1}|\ge \sum_{v\in S_{i-1}} \deg_{G[S_{i-1}]}(v)\ge 4d|S_i|$, so $|S_i|\le |S_{i-1}|/2$ for each $i\ge 1$.  Let $q$ be the maximum integer such that $S_i$ is non-empty.  For each $i\in\{0,\ldots,q\}$, let $L_i:=S_i\setminus S_{i+1}$.  (These notations are mnemonics: $S_i$ are the \defin{survivors} of round $i-1$ and $L_i$ is \defin{layer} $i$.)

  Let $a:=3/2$ and $b:=1/2$.
  We compute our colouring using a two phase algorithm. In the first phase we use a sequence of pairwise-disjoint color palettes $\Phi_0,\ldots,\Phi_{q}$, each of size $2k:=2d^{a}\sqrt{\Delta}\log^{b}n$, such that for each $1\le i < j\le k$, every colour in $\Phi_i$ is less than every colour in $\Phi_j$.  We will use the colours in $\Phi_i$ to colour the vertices in $L_i$, for each $i\in\{0,\ldots,q\}$.  The total number of colours used in this phase is $2k(q+1)\le 2k(1+\log n)=O(d^{a}\sqrt{\Delta}\log^{1+b}n)$.

  % where $\Phi$
  % where $\Phi_i:=\{2i\sqrt{\Delta}+1,\ldots,2(i+1)\sqrt{\Delta}\}$ and is used to colour the vertices of $L_i$, for each $i\in\{0,\ldots,k\}$.

  Fix an arbitrary total order $<_i$ on the vertices of $L_i$ for each $i\in\{0,\ldots,q\}$ and define the total order $<$ on $V(G)$ in which $v <w$ if $v\in L_i$, $w\in L_j$, and $i<j$ or if $v,w\in L_i$ and $v<_iw$. Let $H$ be the directed acyclic graph obtained from $G^2$ by directing each edge $vw$ as $\overrightarrow{vw}$ so that $v<w$.  In the discussion that follows, we will use the notations $N^+_G(v)$ and $\deg^+_G(v)$.  When we do so, we are referring to the directed acyclic graph obtained by orienting each edge $vw$ of $G$ as $\overrightarrow{vw}$ so that $v<w$.  (Note that $H$ contains an edge for every length-$2$ path in the undirected graph $G$, not just length-$2$ directed paths in the oriented version of $G$.)

  First, observe that $\deg^+_G(v)< 4d$ for any vertex $v$ of $G$. Indeed, a vertex $v$ is contained in $L_i$ precisely because $\deg_{G[S_i]}(v)<4d$.  The out-degree bound then follows from the fact that $N_{G}(v)\subseteq S_i$, and $\deg^+_{G}(v)\le\deg_{G[S_i]}(v)<4d$.  We claim that for each vertex $v$ of $G$, $\deg^+_{H}(v)\le (4d-1)(2\Delta+1)$.  To see this, suppose $v\in L_i$ and consider some edge $\overrightarrow{vw}$ of $H$.  The edge  $\overrightarrow{vw}$ is of one of the following types:
  \begin{compactenum}[(T1)]
    \item $\overrightarrow{vw}\in E(G)$. Edges of this type contribute at most $\deg^+_{G}(v)\le 4d-1$ to $\deg^+_{H}(v)$.
    \item $G$ contains a path $vyw$ with $y < v < w$ or $v < y < w$.  Since $\deg_G(v)\le\Delta$, there are at most $\Delta$ choices for $y$.  For each such $y$ there are at most $4d-1$ choices for $w$ (since $y<w$).  Therefore, edges of this type contribute at most $(4d-1)\Delta$ to the out-degree of $v$.
    \item $G$ contains a path $vyw$ with $v < w < y$.  Since $v<y$ there are at most $4d-1$ choices for $y$ and for each such $y$, $\deg_G(y)\le\Delta$, so there are at most $\Delta$ choices for $w$.  Therefore, edges of this type contribute at most $(4d-1)\Delta$ to the out-degree of $v$.
  \end{compactenum}
  We colour the vertices of $G$ in the order given by $<$.  When colouring some vertex $w\in L_i$ we count, for each colour $\alpha\in \Phi_i$, the number $N_\alpha(w)$ of neighbours $y\in N_G(w)$ such that $y < w$ and $y$ has colour $\alpha$ or $y$ already has a neighbour $u$ of colour $\alpha$. Observe that $\sum_{\alpha\in \Phi_i} N_\alpha(w)\le 4d\Delta$ since there are at most $\Delta$ choices for $y$ and for each $y$ there are at most $4d-1$ choices for $u$.  (Since any $u$ coloured with $\alpha\in\Phi_i$ must be in $S_i$, the number of such $u$ is at most $|N_G(y)\cap S_i|\le 4d$, since $y < w\in S_i$.)

  We choose the colour of $w$ uniformly at random from a subpalette of $\Phi_i$ that contains at least half the colours in $\Phi_i$.  Specifically we choose the colour of $w$ from the subpalette $\Phi_w:=\{\alpha\in\Phi_i: N_{\alpha}(w)<M\}$ where $M:=4d\Delta/k$.  This subpalette contains at least $k$ colours because the number of $\alpha\in\Phi_i$ with $N_\alpha(w)\ge M$ is at most $k$ (since $\sum_{\alpha\in\Phi_i} N_\alpha(w) \le 4d\Delta = kM$).
  % Since $\sum_{\alpha\in\Phi_i} N_\alpha(w)\le\deg_G(w)\le\Delta$, the set $\Phi_w$ has size at least $2\sqrt{\Delta}-\sqrt{\Delta}=\sqrt{\Delta}$.
  This completes the description of the first-phase colouring $\varphi$ of $G$.

  % The resulting product colouring is a proper colouring because each edge $vw$ of $G$ either has both endpoints in $L_i$ for some $i\in\{0,\ldots,k\}$, in which case $v$ and $w$ have different colours in the first factor of the product colouring or the second factor in the colours of $v$ and $w$ are taken from disjoint palettes.  We claim that the only violations of the us-colouring conditions occur at three-vertex paths $vyw$ with $v,w\in L_j$ for some $j\in\{0,\ldots,k\}$ and $y\in L_i$ for some $j\in\{0,\ldots,j-1\}$. Indeed, since the colour of $v$ and $w$ are the same, $v$ and $w$ must be in the same layer $L_j$ and $y\not\in L_j$.  Since the colour of $v$ and $w$ is larger than that of $y$, $j> i$.

  We say that a vertex $y$ of $G$ is \defin{problematic} if $y$ has a neighbour in $G$ that receives the same colour as $y$ in the first phase or if $G$ contains a path $vyw$ such that $y\in L_i$, $u,w\in L_j$, $i \le j$ and $u$ and $w$ receive the same colour in phase one.  At this point, we can offer some justification for the definition of the colour set $\Phi_w$ that we choose from when colouring $w$. For each problematic vertex $y$, there exists a minimum vertex $w$ (with respect to $<$) such that $y$ becomes problematic precisely when $w$ is coloured.  When this happens, we say that $w$ \defin{completes} $y$. By definition, if $w$ chooses the colour $\alpha\in\Phi_w$, then it completes at most $|N_{\alpha}(w)|<M$ vertices.

  Let $P$ be the set of all problematic vertices in $G$.  We will re-colour every vertex in $P$ with a colour in a palette $\Phi_{q+1}$ of size $Ck\log n + 1$ whose colours are all larger than all colours in $\Phi_0,\ldots,\Phi_q$.  Since we are recolouring vertices in $P$ with large colours in $\Phi_{q+1}$, the only violations that could occur after recolouring would be caused by paths (with two or three vertices) whose endpoints are in $P$ and that receive the same colour.  In order to avoid these we will properly colour $G^2[P]$ so that any two vertices at distance at most $2$ receive different colours.  To show that this is possible, we will prove that, with positive probability, after phase 1, the maximum out-degree of any vertex in $H[P]$ is at most $ck\log n$ for some constant $c$ that does not depend on $d$, $\Delta$, or $n$.  Therefore there is some assignment of colours in phase one in which the maximum out-degree of $H[P]$ is at most $ck\log n$.  Since $H$ is acyclic, this implies that $G^2[P]$ is $ck\log n$-degenerate, so the $ck\log n + 1$ colours in $\Phi_{q+1}$ are sufficient to properly colour it.

  We now focus on a specific vertex $v$ in $G$ and show that after the first phase, $|N_{H}[v]\cap P|\le C\sqrt{\Delta}\log^{5/4} n$ with probability $1-o(1/n)$.  The union bound then implies that, with probability $1-o(1)$, the maximum out-degree in $H[P]$ is at most $C\sqrt{\Delta}\log^{5/4} n$.  In particular, it implies that there exists a colouring of $G$ with this property.

  For any vertex $p$ of $G$, define $\outn(p):=N_{H}[p]\cap P$. For any vertex $w$ of $H$, let $\comp(p,w):=\{y\in N_{H}(p):\text{$w$ completes $y$}\}$.  Observe that
  \[
    \outn(p) = \bigcup_{w\in V(H)} \comp(p,w) = \bigcup_{w>p} \comp(p,w) \enspace .
  \]
  For any vertex $w>p$, let $C_{p,w}:=\bigcup_{y\in N_{H}(p)} N_{G}(y)$, which is the set of vertices in $N_{H}(p)$ that $w$ could potentially complete.  For each $\alpha\in\Phi_w$, let $\comp'_\alpha(p,w)$ contain exactly those vertices $y\in C_{p,w}$ that have colour $\alpha$ or have a neighbour of colour $\alpha$ immediately before choosing the colour of $w$.  Observe that $\comp'_\alpha(p,w)$ contains every $y\in C_{p,w}$ that would be completed if we were to set the colour of $w$ to $\alpha$ (as well as some additional vertices that may have already been completed by vertices other than $w$).

  Recall that $N_\alpha(w)$ counts the number of neighbours $y$ of $w$ such that $y < w$ and $y$ has colour $\alpha$ or has a neighbour of colour $\alpha$ immediately before we choose the colour of $w$.  Therefore,  $|\comp'_\alpha(p,w)|\le N_\alpha(w)< M$ for each $\alpha\in\Phi_w$.  Now let $\alpha\in\Phi_w$ be the colour that is actually chosen for $w$ and let $\comp'(p,w):=\comp'_\alpha(p,w)$.  We want to study the random variable $n'_{p,w}:=|\comp'(p,w)|\ge |\comp(p,w)|$.  Since $\alpha$ is chosen from $\Phi_w$, $n'_{p,w}\le M$ with probability $1$.

  Let $\alpha_1,\ldots,\alpha_t$ be the colours in $\Phi_w$ ordered so that,
  \[
    |\comp'_{\alpha_1}(p,w)|\ge|\comp'_{\alpha_2}(p,w)|\ge\cdots\ge |\comp'_{\alpha_t}(p,w)| \enspace .
  \]
  Immediately before colouring $w\in L_i$, each $y\in C_{p,w}$ is assigned a colour (possibly in $\Phi_i$) and has at most $4d-2$ neighbours that have already received a colour in $\Phi_i$.  Therefore, $y$ appears in
  $\comp'_{\alpha}(p,w)$ for at most $4d-1$ values of $\alpha$, so
  \[
    \sum_{\alpha\in\Phi_w} |\comp'_{\alpha}(p,w)| \le 4d| C_{p,w}| \enspace .
  \]
  Therefore $i|\comp'_{\alpha_i}(p,w)|\le\sum_{j=1}^i|\comp'_{\alpha_j}(p,w)|\le 4d|C_{p,w}|$, so
  \[
    |\comp'_{\alpha_i}(p,w)|\le \frac{4d|C_{p,w}|}{i} \enspace .
  \]
  Therefore, regardless of any random choices made before choosing the colour of $w$ and any random choices made after choosing the colour of $w$, the random variable $n'_{p,w}$ is dominated by a random variable $N'_{p,w}:=\min\{4d|C_{p,w}|/j,M\}$ where $j$ is chosen uniformly in $\{1,\ldots,k\}$.

  Therefore, $|\outn(p)|$ is dominated by a sum $X:=\sum_{w> v} N'_{p,w}$ of independent random variables.  In the appendix, we show how to use one of Bernstein's Inequalities to prove that $\Pr(X\ge ck\log n)\le n^{-\Omega(c)}$.  Thus, the number of additional colours needed to recolour $P$ is $O(k\log n)$.
\end{proof}

\section{Generalization to $\ell$-Vertex-Ranking}

A vertex colouring $\varphi$ of $G$ is ab \defin{$\ell$-vertex-ranking} of $G$ if, for each path $v_0,\ldots,v_r$ in $G$ with $1\le r\le\ell$ edges, $\varphi(v_0)\neq \varphi(v_r)$ or $\max\{\varphi(v_1),\ldots,\varphi(v_{r-1})\}>\varphi(v_0)$.  The \defin{$\ell$-vertex-ranking} number $\lrn(G)$ is the minimum integer $k$ such that $G$ has a vertex $\ell$-ranking $\varphi:V(G)\to\{1,\ldots,k\}$.  Note that $\varphi$ is a $2$-vertex ranking of $G$ if and only if it is a us-colouring of $G$, so $\trn(G)=\rn{2}(G)$ for every graph $G$.  The same proof gives the following generalization of \cref{d_degenerate_upper_bound}

\begin{thm}
  For any fixed integers $d,\ell\ge 1$, every $n$-vertex $d$-degenerate graph $G$ has $\lrn(G) \le O(n^{(\ell-1)/(\ell+1)}\log  n)$.
\end{thm}

\begin{proof}[Proof Sketch]
  Let $p:=n^{(\ell-1)/(\ell+1)}$ and let $\Delta=n^{2/(\ell+1)}$.  As in the proof of \cref{d_degenerate_upper_bound} eliminate all vertices of degree at last $\Delta$ using $n/\Delta = n^{(\ell-1)/(\ell+1)}=p$ additional high colours.  Next, proceed exactly as in the proof of \cref{degenerate_and_degree} except define $H$ as the directed version of $G^{\ell}$.  Observe that, for every directed edge $\overrightarrow{vy}$ of $H$, $G$ contains a path $v_0,\ldots,v_r$ with $v_0=v$, $v_r=y$, $r\le \ell$ such that $v_a\in L_i$ and $v_{a+1}\in L_j$ for some $i\le j$.  The number of such paths is $O(\Delta^{\ell-1})$. When colouring a vertex $w$ choose the colour of $w$ randomly from a $p$ element subset of a palette of $2p$ colours chosen.  Similar calculations show that, with high probability the number of problematic vertices in $N_{H}(v)$ is at most $O(|N_{H}(v)|\log n/p)=O(\Delta^{\ell-1}/p)=O(p\log n)$.  Thus, the subgraph of $G^\ell$ induced by the set of problematic vertices is $O(p\log n)$-degenerate and can be properly coloured with $O(p\log n)$ colours.
\end{proof}

\todo[inline]{There seems to be a link here with $r$-weak colouring numbers since we've fixed a total order and we're basically counting paths of length up to $\ell$ that start at $v$ and finish at some vertex that comes after $v$.  We should explore this.}

\todo[inline]{Is there an $\Omega(n^{(\ell-1)/(\ell+1)})$ lower bound on the $\ell$-vertex-ranking number of $d$-degenerate graphs for some small constant $d$?}

\bibliographystyle{plainnat}
\bibliography{us2}

\appendix

\section{Bounding the Tail of \texorpdfstring{\boldmath$|\outn(v)|$}{out(v)}}

We make use of the following inequality of Hoeffding \cite[??]{boucheron.lugosi.ea:concentration}:

\begin{thm}\label{hoeffding_theorem}
  Let $X_1,\ldots,X_r$ be independent random variables such that $\Pr(X_i\le M_i)=1$ for each $i\in\{1,\ldots,r\}$, and let $X:=\sum_{i=1}^r X_i$. Then
  \begin{equation}
    \Pr\left(X \ge \E(X)+ t\right)
      \le \exp\left(-\frac{2t^2}{\sum_{i=1}^r M_i^2}\right) \enspace . \label{hoeffding}
  \end{equation}
\end{thm}
We will apply \cref{hoeffding_theorem} to a random variable $X:=\sum_{i=1}^r X_i$ in which each $X_i$ has the following distribution (for some $x_i\le kM$):
\[
  X_i = \begin{cases}
          M_i & \text{with probability $x_i/(kM_i)$} \\
          x_i/j & \text{with probability $1/k$ for $j\in\{x_i/M_i+1,\ldots,k\}$}
        \end{cases}
\]
This is the distribution we get when we choose a uniform $j\in\{1,\ldots,k\}$ and set $X_i:=\min\{M_i,x_i/j)$.  To see how this applies in the proof of \cref{degenerate_and_degree}, let $\{w_1,\ldots,w_r\}:=\bigcup_{y\in N^+H(p)} N^+_G(y)$ and let $x_i:=4d|C_{p,w_i}|$, for each $i\in\{1,\ldots,r\}$.
Observe that $w_1,\ldots,w_r$ are precisely the vertices that could complete some $y\in N^+_H(p)$.  We have already defined $k=d^a\sqrt{\Delta}\log^{b} n$ and we have $M_i:=\max\{N_\alpha(w_i):\alpha \in \Phi_{w_i}\}\le 4d\Delta/k$. Observe that $w_i$ has at least $kM_i$ neighbours $y$ in $N^+_H(p)$ such that $w\in N^+_G(y)$.  Therefore $w$ contributes at least $kM_i$ to $\sum_{y\in N^+_H(p)}\deg^+_G(y)= O(d^2\Delta)$.  Therefore $\sum_{i=1}^r M_i = O(d^2\Delta/k)$.  We can now upper bound the denominator in \cref{hoeffding}.  Since $f(x)=x^2$ is convex and increasing on $[0,\infty]$, the denominator is maximized by setting as many terms as possible to their largest allowable value given the local constraint $M_i \le 4d\Delta/k$.  However, the number of these terms is limited to $O(d^2)$ by the global constraint $\sum_{i=1}^r M_i= O(d^2\Delta/k)$, giving
\[
    \sum_{i=1}^r M_i^2 \le \left(\frac{4d\Delta}{k}\right)^2\cdot O(d^2) = O\left(\frac{d^4\Delta^2}{k^2}\right)
\]
by convexity.

% Then
% \[
%    \sum_{i=1}^r M_i\le \sum_{i=1}^r\sum_{\alpha} N_\alpha(w_i)
%    \le \sum_{y\in N^+_H(p)}\deg^+_G(y)^2
%    < |N^+_H(p)|\cdot 16d^2 = O(d^3\Delta) \enspace .
% \]

Setting $t=ck\log n$ and applying \cref{hoeffding} we get
\begin{align*}
  \Pr(X\ge \E(X) + ck\log n)
  & \le \exp\left(-\frac{2(ck\log n)^2}{\sum_{i=1}^r M_i^2}\right) \\
  & \le \exp\left(-\Omega\left(\frac{c^2k^4\log^2 n}{d^4\Delta^2}\right)\right) \\
  & = \exp\left(-\Omega\left(\frac{c^2d^{4a}\log^{2+4b} n}{d^4}\right)\right) \\
  & \le \exp(-\Omega(c^2\log n)) = n^{-\Omega(c^2)} = o(1/n)
\end{align*}
for any $a\ge 1$ and $b\ge -1/4$ and some sufficiently large constant $c$.  In particular, $a=3/2$ and $b=1/2$ satisfy these constraints.  All that remains is to upper bound $\E(X)$.  We begin with $\E(X_i)$:
\begin{align*}
  \E(X_i)
  & =\Pr(X_i=M)\cdot M + \sum_{j=x_i/M+1}^k \Pr(X_i=j)\cdot\frac{x_i}{j} \\
  & =\frac{x_i}{kM}\cdot M + \frac{1}{k}\cdot\sum_{j=x_i/M+1}^k \frac{x_i}{j} \\
  & \le \frac{x_i}{k} + \frac{1}{k}\cdot\sum_{j=1}^k \frac{x_i}{j} \\
  & \le \frac{x_i(2+\ln k)}{k} \\
  % & = O\left(\frac{x_i}{k}+\frac{x_i\log k}{k}\right) \\
  & = O\left(\frac{x_i\log k}{k}\right) \\
  & = O\left(\frac{x_i\log n}{k}\right)
  \enspace ,
\end{align*}
since $d,\Delta\le n$.  Then
\[
  \E(X) := \sum_{i=1}^r\E(X_i) \le \left(\sum_{i=1}^r x_i\right)\cdot O\left(\frac{\log n}{k}\right) = O\left(\frac{d^3\Delta\log n}{k}\right)
   \enspace .
\]
In this case,
\[
  \E(X)+t = O(d^3\Delta\log n/k + ck\log n)
  = O(d^{3-a}\sqrt{\Delta}\log^{1-b} n + d^a\sqrt{\Delta}\log^{b} n)
  = O(d^{3/2}\sqrt{\Delta}\log^{1/2}n) \enspace .
  % = O(d^{3/2}\log^{1/4} n + d^{3/2}\log^{3/4} n)
  % = O(d^{3/2}\log^{3/4} n)  \enspace .
\]
Thus, $\Pr(X\ge c'd^{3/2}\log^{1/2} n) \le n^{-\Omega(c')}=o(1/n)$ for a sufficiently large constant $c'$.
%
% The rest of this appendix is devoted to bounding the various quantities that appear in \cref{hoeffding} so that we can show that the right-hand side of \cref{hoeffding} is $o(1/n)$.  In our setting $k:=d^a\sqrt{\Delta}\log^b n$ for some constants $a,b>0$.  By the end of the appendix, we will have shows that $a=3/2$ and $b=3/4$ satisfy our requirements.
%
% Both the maximum value and the sum of $x_1,\ldots,x_n$ are important for us.  Since $C_{v,w}\subseteq N_G(w)$, we have $x_i\le 4d\deg_G(w_i)\le 4d\Delta$ for all $i\in\{1,\ldots,n\}$, so $\max\{x_1,\ldots,x_n\}\le 4d\Delta$. The sum can be bounded by
% \[
%   \sum_{i=1}^n x_i
%     = \sum_{i=1}^n 4d|C_{v,w_i}|
%     \le 4d\cdot \sum_{y\in N_{H}[p]} \deg_{G}(y)
%     \le 16d^2|N_{H}[p]|=O(d^3\Delta)
%   \enspace .
% \]
% Then we have
% \begin{align*}
%   \E(X_i)
%   & =\Pr(X_i=M)\cdot M + \sum_{j=x_i/M+1}^k \Pr(X_i=j)\cdot\frac{x_i}{j} \\
%   & =\frac{x_i}{kM}\cdot M + \frac{1}{k}\cdot\sum_{j=x_i/M+1}^k \frac{x_i}{j} \\
%   & = \frac{x_i}{k} + \frac{x_i}{k}(H_{k}-H_{x_i/M}) \\
%   & \le \frac{x_i}{k}(1+H_{k}) \\
%   & \le \frac{x_i(2+\ln k)}{k} \\
%   % & = O\left(\frac{x_i}{k}+\frac{x_i\log k}{k}\right) \\
%   & = O\left(\frac{x_i\log k}{k}\right) \\
%   & = O\left(\frac{x_i\log n}{k}\right)
%   \enspace ,
% \end{align*}
% where the last line comes from the fact that $d,\Delta \le n$.
% Therefore,
% \begin{align*}
%   (\E(X_i))^2
%   & = O\left(\left(\frac{x_i\log n}{k}\right)^2\right) \\
%   & = O\left(\frac{x_i^2\log^2 n}{k^2}\right) \\
%   & = O\left(\frac{x_i^2\log^2 n}{d^{2a}\Delta\log^{2b}\Delta}\right) \\
%   % & = O\left(\frac{x_i^2\log^{2-2?} \Delta}{d\Delta}\right) \\
%   & = O(d^{1-2a}x_i\log^{2-2b} n) \enspace .
% \end{align*}
% Recall that $M:=4d\Delta/k=4d^{1-a}\sqrt{\Delta}\log^{-b}n$. Therefore,
% \begin{align*}
%   \E((X_i-\E(X_i))^2)
%   & = \frac{x_i}{kM}\cdot(M-\E(X_i))^2
%     + \sum_{j=x_i/k+1}^k \frac{1}{k}\left(\frac{x_i}{j}-\E(X_i)\right)^2 \\
%   & \le \frac{x_i}{kM}\left(M^2 + (\E(X_i))^2\right)
%     + \sum_{j=x_i/k+1}^k \frac{1}{k}\left(\frac{x_i}{j}-\E(X_i)\right)^2 \\
%   & = \frac{M x_i}{k} + \frac{x_i}{kM}\cdot (\E(X_i))^2
%       + \sum_{j=x_i/k+1}^k \frac{1}{k}\left(\frac{x_i}{j}-\E(X_i)\right)^2 \\
%   & = x_id^{1-2a}\log^{-2b}n + \frac{x_i}{kM}\cdot (\E(X_i))^2
%       + \frac{1}{k}\cdot\sum_{j=x_i/k+1}^k \left(\frac{x_i}{j}-\E(X_i)\right)^2 \\
%   & < x_i + \frac{x_i}{kM}\cdot (\E(X_i))^2
%       + \frac{1}{k}\cdot\sum_{j=x_i/k+1}^k \left(\frac{x_i}{j}-\E(X_i)\right)^2
%       & \text{(for $a\ge 1/2$)} \\
%   & \le x_i + (\E(X_i))^2
%       + \sum_{j=x_i/k+1}^k \frac{1}{k}\left(\frac{x_i}{j}-\E(X_i)\right)^2
%       & \text{\quad(since $x_i\le 4d\Delta= kM$)} \\
%  & < x_i + (\E(X_i))^2 + \sum_{j=x_i/M+1}^k \frac{1}{k}\left(\frac{x_i^2}{j^2} + (\E(X_i))^2\right) \\
%  & \le x_i + 2(\E(X_i))^2  +  \sum_{j=x_i/M+1}^k\frac{1}{k}\cdot\frac{x_i^2}{j^2}
%  & \text{(since $(k-x_i/M)/k \le 1$)} \\
%  & = x_i + 2(\E(X_i))^2  +  \frac{x_i^2}{k}\cdot \sum_{j=x_i/M+1}^k\frac{1}{j^2} \\
%  & < x_i + 2(\E(X_i))^2 + \frac{x_i^2}{k}\cdot\frac{M\pi^2}{6 x_i}
%     & \text{(since $\sum_{j=a}^{\infty} \tfrac{1}{j^2} \le \tfrac{\pi^2}{6a}$, for $a\ge 1$)} \\
%  & < (1+\pi^2/6)x_i + 2(\E(X_i))^2
%     & \text{(for $a\ge 1/2$)} \\
%   & = O(d^{1-2a}x_i\log^{2-2b}n) \enspace .
% \end{align*}
% Recall that $\sum_{i=1}^r x_i = O(d^3\Delta)$, so
% \[
%   \E(X)
%   = \sum_{i=1}^r \E(X_i)
%   = \sum_{i=1}^r O\left(\frac{x_i\log n}{k}\right)
%   = O\left(\frac{d^3\Delta\log n}{k}\right)
%   = O\left(d^{3-a}\sqrt{\Delta}\log^{1-b} n\right) \enspace .
% \]
% and
% \[
%   \sum_{i=1}^r\E((X_i-\E(X_i))^2)
%   = \sum_{i=1}^r O(d^{1-2a}x_i\log^{2-2b} n)
%   = O(d^{4-2a}\Delta\log^{2-2b} n)  \enspace .
% \]
% Setting $t=ck\log n$, for some $c\ge 1$, and plugging this into \cref{hoeffding} gives:
% \begin{align*}
%   \Pr(X\ge \E(X)+t)
%   & = \Pr(X\ge \E(X)+ck) \\
%   & \le \exp \left(-\frac{\tfrac{1}{2}(ck\log n)^2}{O(d^{4-2a}\Delta\log^{2-2b}n) + \tfrac{1}{3}Mck\log n}\right) \\
%   & = \exp \left(-\frac{\tfrac{1}{2}(ck\log n)^2}{O(d^{4-2a}\Delta\log^{2-2b}n) + \tfrac{4}{3}cd\Delta\log n}\right)
%     & \text{(since $Mk=4d\Delta$)} \\
%   % & = \exp \left(-\frac{\tfrac{1}{2}(ck)^2}{O(d^{4-2a}\Delta\log^{2-2b}n) + \tfrac{4}{3}cd\Delta}\right) \\
%   & \le \exp \left(-\frac{\tfrac{1}{2}(ck\log n)^2}{O(cd^{4-2a}\Delta\log^{2-2b}n) + \tfrac{4}{3}cd\Delta\log n}\right)
%   & \text{(since $c\ge 1$)}\\
%   & \le \exp \left(-\frac{\tfrac{1}{2}(ck\log n)^2}{O(cd^{4-2a}\Delta\log^{2-2b}n) + \tfrac{4}{3}cd^{4-2a}\Delta\log n}\right)
%   & \text{(for $a\le 3/2$)}\\
%   & \le \exp \left(-\frac{\tfrac{1}{2}(ck\log n)^2}{O(cd^{4-2a}\Delta\log^{2-2b}n) + \tfrac{4}{3}cd^{4-2a}\Delta\log^{2-2b}n}\right)
%   & \text{(for $b\le 1/2$)}\\
%   & = \exp \left(-\frac{\tfrac{1}{2}(c^2d^{2a}\Delta\log^{2+2b} n)}{O(cd^{4-2a}\Delta\log^{2-2b}n) + \tfrac{4}{3}cd^{4-2a}\Delta\log^{2-2b}n}\right) \\
%   & = \exp \left(-\Omega\left(cd^{4a-4}\log^{4b}n\right)\right) \\
%   & \le \exp \left(-\Omega\left(c\log^{4b}n\right)\right)
%   & \text{(for $a\ge 1$)}\\
%   & \le \exp \left(-\Omega\left(c\log n\right)\right)
%   & \text{(for $b\ge 1/4$)}\\
%   & = n^{-\Omega(c)} = o(1/n)
% \end{align*}
% for any sufficiently large constant $c$.  This calculations assumes that $1\le a\le 3/2$ and that $1/4\le b\le 1/2$.  In particular, $a:=3/2$ and $b:=1/2$ satisfy these requirements.  In this case,
% \[
%   \E(X)+t = O(d^3\Delta\log n/k + k)
%   = O(d^{3-a}\sqrt{\Delta}\log^{1-b} n + d^a\sqrt{\Delta}\log^{b} n)
%   = O(d^{3/2}\sqrt{\Delta}\log^{1/2}n) \enspace .
%   % = O(d^{3/2}\log^{1/4} n + d^{3/2}\log^{3/4} n)
%   % = O(d^{3/2}\log^{3/4} n)  \enspace .
% \]
% Thus, $\Pr(X\ge c'd^{3/2}\log^{1/2} n) \le n^{-\Omega(c')}=o(1/n)$ for a sufficiently large constant $c'$.
\end{document}
